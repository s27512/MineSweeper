<!doctype html>
<html>
<head>
    <title>Minesweeper</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
    <script>
        var timerInterval;

        function startTimer(startTime) {
            var timerElement = document.getElementById('timer');
            timerElement.dataset.startTime = startTime;
            timerInterval = setInterval(function() {
                var elapsedTime = Date.now() - parseInt(timerElement.dataset.startTime);
                var seconds = Math.floor(elapsedTime / 1000);
                timerElement.textContent = seconds + " seconds";
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function toggleFlag(event, row, col) {
            event.preventDefault();
            var cell = document.getElementById('cell-' + row + '-' + col);
            var isFlagged = cell.classList.toggle('flag');
            var flagInput = document.getElementById('flag-' + row + '-' + col);
            flagInput.value = isFlagged ? '1' : '0';
        }

        window.onload = function() {
            var startTime = parseInt(document.getElementById('timer').dataset.startTime);
            if (startTime > 0) {
                startTimer(startTime);
            }
        };
    </script>
</head>
<body>
    <div class="container">
        <h1>Minesweeper</h1>
        <div id="timer" class="timer" data-start-time="{{ start_time }}"></div>
        <table>
            <tbody>
                {% for r in range(board|length) %}
                <tr>
                    {% for c in range(board[0]|length) %}
                    <td>
                        {% set cell_id = 'cell-' + r|string + '-' + c|string %}
                        {% set cell_class = 'cell' %}
                        {% if revealed[r][c] %}
                            {% if board[r][c] == 'M' %}
                                {% set cell_class = cell_class + ' bomb' %}
                            {% else %}
                                {% set cell_class = cell_class + ' revealed revealed-' + board[r][c] %}
                            {% endif %}
                        {% endif %}
                        {% if flags[r][c] %}
                            {% set cell_class = cell_class + ' flag' %}
                        {% endif %}
                        <button id="{{ cell_id }}" class="{{ cell_class }}" {% if not revealed[r][c] or board[r][c] == 'M' %}onclick="reveal('{{ r }}', '{{ c }}')" {% endif %}>
                            {% if flags[r][c] %}
                                <img src="{{ url_for('static', filename='flag.png') }}" width="20" height="20" alt="Flag">
                            {% elif revealed[r][c] and board[r][c] == 'M' %}
                                <img src="{{ url_for('static', filename='bomb.png') }}" width="20" height="20" alt="Bomb">
                            {% elif revealed[r][c] and board[r][c]|int > 0 %}
                                {{ board[r][c] }}
                            {% endif %}
                        </button>
                        <input type="hidden" id="flag-{{ r }}-{{ c }}" name="flag-{{ r }}-{{ c }}" value="0">
                    </td>
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% if game_over %}
            <h2>Game Over</h2>
            <a class="play-again" href="{{ url_for('menu') }}">Play Again</a>
        {% endif %}
    </div>
</body>
</html>
